<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Normal headers go here -->
	<title>Much Ado about Nothing</title>

	<!-- Page-related styles -->
	<link href="newspaper.css" rel="stylesheet">
	<link href="libs/font-awesome-4.6.3/css/font-awesome.min.css" rel="stylesheet">
	<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="mypage">
	<!--[if lt IE 8]>
	<p class="browserupgrade">You are using an <strong>outdated</strong> browser.
	Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
	<![endif]-->
	<div class="canvas">
		<div class="jumbotron">
			<div class="head1">
				<div class="container">
					<p class="theatre">Theatre</p>
					<h1>Much Ado About Nothing review – sharp,<br>
						smart and very funny</h1>
					</div>
				</div>

				<div class="head2">
					<div class="container">
						<h3>Dundee Rep</h3>
						Benedick and Beatrice offer a romance worth believing in Irene Macdougall’s intelligent, well paced production
					</div>
				</div>
			</div><!-- jumbotron -->
			<div class="container">
				<div class="row">
					<div class='col-md-12'>
						<h1>Much Ado about Nothing</h1>
						<img src="images/muchAdoAboutNothing.jpg" class="newspaper-img">
						<br/>
						<div class="imagetext">Peekaboo … Much Ado About Nothing at Dundee Rep. Photograph: Tommy Ga-Ken Wan</div>
						<br/>
						<p class="newspaper-p">
							Keep an eye on Robert Jack’s left hand. When the actor strides on with suave confidence as Benedick in
							Shakespeare’s romcom, it is at ease by his side. The second he becomes unsettled, as word gets round
							that Emily Winter’s Beatrice may have her sights on him, his hand is all aflutter. It seeks purchase
							on his hip, then fails and flits up to his chin. No joy there, so on to the tip of his head and down
							again. It never rests. This master of repartee is undone. He is a mess of twitches, hesitations and
							double takes. He makes it very funny.
						</p>
					</div>
				</div>


				<!-- This is where the Crowd Hound comments will be placed. -->
				<div class="row">
					<div class="col-md-12 bg-grey">
						<h3>Comments</h3>
						<div id="thread" class="curia-thread">Please wait...</div>
					</div>
				</div>


				<!-- page footer -->
				<div class="row">
					<div class='col-md-12'>
						<hr/>
						<p class="newspaper-p">
							Contents and images courtesy of
							<a href="https://www.theguardian.com/stage/2016/jun/12/much-ado-about-nothing-review">The Guardian</a> newspaper.
							<br/><br/>
						</p>
					</div>
				</div>
			</div>
		</div>
	</body>

	<!-- Page-related Javascript -->
	<script src="libs/jquery-1.11.3/jquery.min.js"></script>
	<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>

	<!-- Crowdhound-related Javascript -->
	<script src="http://auf.crowdhound.io/libs/mustache-2.1.3/mustache.min.js"></script>
	<script src="http://auf.crowdhound.io/js/curia-0.1.2.js"></script>












	<script type="text/javascript">var BlogUtil = function() {
		//var _TENANT = Config.TENANT;
		//var _forumUrl = Config.API_SERVER;
		//var blogMasterPostId = 278060;
		var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

		var initialize = function(callback) {
			var params = {},
			tokens,
			development_userId,
			authenticationToken;

			window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (str, key, value) {
				params[key] = value;
			});

			if (params.development_userId || params.key || params.authenticationToken) {
				tokens = {
					authenticationToken: params.key || params.authenticationToken,
					development_userId: params.development_userId
				};
				$.cookie("curia-token", JSON.stringify(tokens), {
					path: '/'
				});
				var url = window.location.origin + window.location.pathname;
				return window.location.replace(url);
			} else {
				var cookieTokens = $.cookie("curia-token");
				if (cookieTokens) {
					tokens = JSON.parse(cookieTokens);
					if (tokens) {
						development_userId = tokens.development_userId;
						authenticationToken = tokens.authenticationToken;
					}
				} else {
					tokens = {};
					tokens.development_userId = null;
					tokens.authenticationToken = null;
				}
			}
			return callback(params, tokens);
		};

		var redirect = function(roleId) {
			if (roleId === 7 || location.href.indexOf("blog-admin") > -1 || location.href.indexOf("blog-admin-category") > -1) {
				jQuery.ajax({
					url :  Config.GSP_HOME + "/api/blog/logout",
					success : function(data, textStatus, xhr) {
						Config.CURRENT_ROLE_ID = 0;
						if (xhr.status === 200) {
							window.location.href = $("#gspLoginUrl").val();
						}
					}
				});
			} else {
				jQuery.ajax({
					url :  Config.STUDYLANE_HOME + "/api/blog/logout",
					success : function(data, textStatus, xhr) {
						Config.CURRENT_ROLE_ID = 0;
						if (xhr.status === 200) {
							window.location.href = $("#studylaneLoginUrl").val();
						}
					}
				});
			}
		}

		var dateParser = function( timestamp ) {
			var date = new Date(timestamp * 1000);
			var cDate = new Date();
			var fDate = "";
			var eDate = {
				hours : date.getHours(),
				minutes : date.getMinutes(),
				seconds : date.getSeconds(),
				ampm : "AM",
				month : date.getMonth(),
				date : date.getDate(),
				year : date.getFullYear()
			};
			if( date.getFullYear() == cDate.getFullYear() &&
			date.getMonth() == cDate.getMonth() &&
			date.getDate() == cDate.getDate() ) {
				fDate = "Today,";
				if (cDate.getHours() > date.getHours()) {
					var hours = cDate.getHours() - date.getHours() > 1 ? "hours" : "hour";
					fDate += " " + (cDate.getHours() - date.getHours()) + " " + hours;
				}
				if (cDate.getMinutes() > date.getMinutes()) {
					var minutes = cDate.getMinutes() - date.getMinutes() > 1 ? "minutes" : "minute";
					fDate += " " + (cDate.getMinutes() - date.getMinutes()) + " " + minutes;
				}
				if (cDate.getSeconds() > date.getSeconds()) {
					fDate += " " + (cDate.getSeconds() - date.getSeconds()) + " seconds";
				}
				fDate += " ago";
			} else {
				if( eDate.hours >= 12 ) {
					eDate.hours = eDate.hours - 12;
					eDate.hours = eDate.hours == 0 ? 12 : eDate.hours;
					eDate.ampm = "PM";
				}
				eDate.hours = eDate.hours < 10 ? "0" + eDate.hours : eDate.hours;
				eDate.minutes = eDate.minutes < 10 ? "0" + eDate.minutes : eDate.minutes;
				eDate.seconds = eDate.seconds < 10 ? "0" + eDate.seconds : eDate.seconds;
				eDate.month = monthNames[eDate.month];
				eDate.date = eDate.date < 10 ? "0" + eDate.date : eDate.date;
				//fDate = eDate.month + " " + eDate.date + ", " + eDate.year + " " + eDate.hours + ":" + eDate.minutes + ":" + eDate.seconds + " " + eDate.ampm ;
				fDate = eDate.month + " " + eDate.date + ", " + eDate.year + " " + eDate.hours + ":" + eDate.minutes + " " + eDate.ampm ;
			}
			return fDate;
		};

		function dateFromNow(date){
			var fromNow = '';
			var comparison = moment.unix(date);
			if (comparison.isValid()) {
				var now = moment(new Date());

				// Minute comparison
				var dateDiff = now.diff(comparison, 'minutes');
				if (dateDiff === 0) {
					fromNow = 'Just now';
				} else if (dateDiff >= 1 && dateDiff <= 120) {
					var min = dateDiff == 1 ? ' min ago' : ' mins ago';
					fromNow = dateDiff + min;
				}

				// Hour comparison
				dateDiff = now.diff(comparison, 'hours');
				if (dateDiff >= 1 && dateDiff <= 23) {
					var hr = dateDiff == 1 ? ' hr ago' : ' hrs ago'
					fromNow = dateDiff + hr;
				}

				// Day comparison
				dateDiff = now.diff(comparison, 'days');
				if (dateDiff === 1) {
					fromNow = 'Yesterday at ' + comparison.format('hh:mm A');
				} else if (dateDiff >= 2 && dateDiff <= 6) {
					fromNow = comparison.format('dddd') + ' at ' + comparison.format('hh:mm A');
				} else if (dateDiff >= 7) {
					if (now.year() === comparison.year()) {
						fromNow = comparison.format('DD MMMM') + ' at ' + comparison.format('hh:mm A');
					} else {
						fromNow = comparison.format('DD MMMM YYYY') + ' at ' + comparison.format('hh:mm A');
					}
				}
			}
			return fromNow;
		}

		var getTopicImage = function(elementId, callback, async, type) {
			if (type == undefined || type == 'topic') {
				jQuery.ajax({
					url :  Config.API_SERVER + "/elementsByType/attachment",
					async : async == undefined ? true : async,
					success : function(data, textStatus, xhr) {
						if (xhr.status === 200) {
							var responseData = {};
							var isDefaultImage = true;
							var bannerImage = "//dbgw6333l9sbi.cloudfront.net/curia-studylane/no-image-available.png";
							var fileName = "placeholder.png";
							var fileSize = 0;
							var id = 0;
							jQuery.each(data, function(index, value) {
								if (value.parentId === elementId) {
									isDefaultImage = false;
									bannerImage = "//dbgw6333l9sbi.cloudfront.net/curia-files/" + Config.ENVIRONMENT + "/" + value.userId + "/" + value.filename;
									fileName = value.filename;
									fileSize = value.filesize;
									id = value.id;
								}
							});
							responseData = {
								"isDefaultImage": isDefaultImage,
								"bannerImage": bannerImage,
								"fileName": fileName,
								"fileSize": fileSize,
								"id": id
							}
							callback(responseData);
						}
					}
				});
			} else {
				callback(null);
			}
		};

		var getParameter = function(callback) {
			var params = {}
			window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (str, key, value) {
				params[key] = value;
			});
			return callback(params);
		}

		var getElementsByType = function(type, callback) {
			jQuery.ajax({
				url :  Config.API_SERVER + "/elementsByType/" + type,
				success : function(data, textStatus, xhr) {
					if (xhr.status === 200) {
						callback(data);
					}
				}
			});
		};

		var getCategory = function(elementId, callback) {
			getElementsByType('category', function(data) {
				var resp = {};
				jQuery.each(data, function(index, value) {
					if (elementId === value.id) {
						resp.categoryId = value.id;
						resp.category = value.summary;
						resp.deleted = value.deleted;
					}
				});
				callback(resp);
			});
		};

		var getMyVotes = function(elementId, callback, async, type) {
			if (type == undefined || type == 'topic') {
				jQuery.ajax({
					url :  Curia.addAuthenticationToken(Config.API_SERVER + "/votes/mine/" + elementId),
					async : async == undefined ? true : async,
					success : function(data, textStatus, xhr) {
						if (xhr.status === 200) {
							callback(data);
						}
					}
				});
			} else {
				callback(null);
			}
		};

		var getVoteTotals = function(elementId, type, callback, async) {
			if (elementId != undefined) {
				jQuery.ajax({
					url :  Curia.addAuthenticationToken(Config.API_SERVER + "/vote/totals/" + elementId + "/" + type),
					async : async == undefined ? true : async,
					success : function(data, textStatus, xhr) {
						if (xhr.status === 200) {
							callback(data);
						}
					}
				});
			} else {
				callback();
			}
		};

		var cook_topicTableZebra = function(params, selection, callback) {
			console.log('cook_topicTableZebra()');
			var ctr = 0;
			CrowdHound.traverse(selection, function cookTopic(level, element, parent, next) {
				if (element.type == "category" && element.deleted != 1) {
					element.jsonValue = JSON.stringify({
						summary : element.summary,
						description : element.description,
						id : element.id,
						parentId : element.parentId,
						rootId : element.rootId
					}).replace(/\"/g, "\\\"");

				}

				if (element.type == "topic") {
					if (ctr % 2 == 0) {
						element.oddEven = "topic-even";
					} else {
						element.oddEven = "topic-odd";
					}
					ctr++;
				}

				// On to next element
				return next(null);
			}, callback);// traverse
		}

		var cook_categoryTableZebra = function(params, selection, callback) {
			console.log('cook_categoryTableZebra()');
			var ctr = 0;
			CrowdHound.traverse(selection, function cookTopic(level, element, parent, next) {

				if (element.type == "category") {
					if (ctr % 2 == 0) {
						element.oddEven = "topic-even";
					} else {
						element.oddEven = "topic-odd";
					}
					ctr++;
				}

				// On to next element
				return next(null);
			}, callback);// traverse
		}

		/**
		* Set variables in topic elements, used by mustache templates to provide styles, etc.
		* Note: Cooker functions replace the 'preProcess' function in previous versions of Curia.
		*/
		var cook_topicVariables = function(params, selection, callback) {
			console.log('cook_topicVariables()');
			var ctr = 0;
			CrowdHound.traverse(selection, function cookTopic(level, element, parent, next) {

				if (element.type == 'topic' && element.deleted != 1) {
					if (ctr <= 0) {
						element.featuredTopic = true;
					} else if (ctr <= 4) {
						element.latestTopic = true;
						if (ctr == 1) {
							element.firstRow = true;
						}
						if (ctr == 4) {
							element.endRow = true;
						}
					} else if (ctr > 4) {
						element.nextRow = true;
						if (ctr % 5 == 0) {
							element.firstOffset = true;
						} else {
							element.firstOffset = false;
						}
					}

					element.hasRelatedTopic = false;
					getParameter(function(respData) {
						if (element.parentId === parseInt(respData.categoryId) && element.type === "topic" && element.id != parseInt(respData.topicId)) {
							element.hasRelatedTopic = true;
						}
					});

					ctr++;
				}

				// On to next element
				return next(null);
			}, callback);// traverse
		}

		/**
		* Find the images for topics from their child 'attachment' elements.
		* Note: Cooker functions replace the 'preProcess' function in previous versions of Curia.
		*/
		var cook_topicImages = function(params, selection, callback) {
			console.log('cook_topicImages()');
			CrowdHound.traverse(selection, function cookTopic(level, element, parent, next) {

				if (element.type == 'topic' && element.deleted != 1) {

					/*
					* Find the banner image from a child attachment element.
					*/
					//element.banner_image = "http://www.aspneter.com/aspneter/wp-content/uploads/2016/01/no-thumb.jpg";
					element.banner_image = "//dbgw6333l9sbi.cloudfront.net/curia-studylane/no-image-available.png";
					if (element.children) {
						for (var i = 0; i < element.children.length; i++) {
							var child = element.children[i];
							if (child.type == 'attachment') {
								//element.banner_image = "//curia-s3-aws.s3.amazonaws.com/curia-files/dev/" + child.userId + "/" + child.filename;
								element.banner_image = "//dbgw6333l9sbi.cloudfront.net/curia-files/" + Config.ENVIRONMENT + "/" + child.userId + "/" + child.filename;
								break;
							}
						}
					}
				}

				// On to next element
				return next(null);

			}, callback);// traverse
		}

		/**
		* Get the number of likes for each topic element.
		* Note: Cooker functions replace the 'preProcess' function in previous versions of Curia.
		*/
		var cook_likes = function(params, selection, callback) {
			console.log('cook_likes()');

			var ids = '';
			var sep = '';
			var topics = [ ]; // [ element ]
			CrowdHound.traverse(selection, function cookTopic(level, element, parent, next) {

				// Called for each element in the hierarchy.
				if (element.type != 'topic' && element.deleted != 1) {
					return next(null);
				}
				topics.push(element);
				ids += sep + element.id;
				sep = ',';
				//console.log('ids=' + ids);
				return next(null);
			}, function() {

				// Called after traversal is finished (and we have the ids and elements).
				//console.log('select with ids=' + ids)
				getVoteTotals(ids, 'like', function(reply) {
					// reply is [ { elementId, num, total } ]
					//console.log('votes reply is ', reply)

					// Create an index of vote records
					var index = [ ]; // elementId -> { elementId, num, total }
					for (var i = 0; i < reply.length; i++) {
						var rec = reply[i];
						index[rec.elementId] = rec;
					}

					// Now patch the vote details into the topic elements.
					for (var i = 0; i < topics.length; i++) {
						var element = topics[i];
						//console.log('have element ', element)
						var vote = index[element.id];
						//console.log('have vote ', vote)
						if (vote) {
							element.likes = vote.num;
							if (element.likes > 1) {
								element.likePlural = true;
							}
						}
					}

					// This cooker is finished.
					return callback();

				}, false);// getVoteTotals
			});// traverse
		}

		var cook_myVotes = function(params, selection, callback) {
			console.log('cook_myVotes()');

			var topics = [ ]; // [ element ]
			CrowdHound.traverse(selection, function cookTopic(level, element, parent, next) {

				if (element.type != 'topic' && element.deleted != 1) {
					return next(null);
				}
				topics.push(element);
				return next(null);
			}, function() {

				// Called after traversal is finished (and we have the ids and elements).
				//console.log('select with ids=' + ids)
				getMyVotes(topics[0].id, function(reply) {
					for (var i = 0; i < topics.length; i++) {
						var element = topics[i];
						if (reply.length == 0) {
							element.liked = true;
						} else {
							element.liked = false;
						}
					}

					// This cooker is finished.
					return callback();

				});// getMyVotes
			});// traverse
		}

		/**
		* Get the number of likes for each topic element.
		* Note: Cooker functions replace the 'preProcess' function in previous versions of Curia.
		*/
		var cook_category = function(params, selection, callback) {
			console.log('cook_category()');

			var ids = '';
			var sep = '';
			var topics = [ ]; // [ element ]
			CrowdHound.traverse(selection, function cookTopic(level, element, parent, next) {

				// Called for each element in the hierarchy.
				if (element.type != 'topic' && element.deleted != 1) {
					return next(null);
				}
				topics.push(element);
				ids += sep + element.id;
				sep = ',';
				//console.log('ids=' + ids);
				return next(null);
			}, function() {

				// Called after traversal is finished (and we have the ids and elements).
				//console.log('select with ids=' + ids)
				getElementsByType('category', function(reply) {
					// reply is [ { elementId, num, total } ]
					//console.log('category reply is ', reply)

					// Create an index of category records
					var index = [ ]; // elementId -> { elementId, num, total }
					for (var i = 0; i < reply.length; i++) {
						var rec = reply[i];
						index[rec.id] = rec;
					}

					// Now patch the vote details into the topic elements.
					for (var i = 0; i < topics.length; i++) {
						var element = topics[i];
						//console.log('have element ', element)
						var cat = index[element.parentId];
						//console.log('have category ', cat)
						if (cat) {
							var category = {};
							category.categoryId = cat.id;
							category.category = cat.summary;
							category.deleted = cat.deleted;
							element.category = category;
						}
					}

					// This cooker is finished.
					return callback();
				});
			});// traverse
		}

		var getAbusiveReason = function(callback) {
			jQuery.ajax({
				url :  Config.API_SERVER + "/abusivePostReasons",
				success : function(data, textStatus, xhr) {
					if (xhr.status === 200) {
						callback(data);
					}
				}
			});
		};

		return {
			init : initialize,
			redirect: redirect,
			dateParser: dateParser,
			dateFromNow: dateFromNow,
			getTopicImage: getTopicImage,
			getParameter: getParameter,
			getElementsByType: getElementsByType,
			getCategory: getCategory,
			getMyVotes: getMyVotes,
			getVoteTotals: getVoteTotals,
			getAbusiveReason : getAbusiveReason,
			cook_topicTableZebra: cook_topicTableZebra,
			cook_categoryTableZebra: cook_categoryTableZebra,
			cook_topicVariables: cook_topicVariables,
			cook_topicImages: cook_topicImages,
			cook_likes: cook_likes,
			cook_myVotes: cook_myVotes,
			cook_category: cook_category
		}
	}();


	jQuery(document).on("click", ".logout", function() {
		$.removeCookie('curia-token', { path: '/' });
		BlogUtil.redirect(Config.CURRENT_ROLE_ID);
	});

	jQuery(document).on("click", ".topic-clickable", function() {
		var _this = jQuery(this);
		var curiaElm = _this.closest('.topic-clickable').find('.curia-element-NEW');
		var elmId = curiaElm.attr('data-curia-elementid');
		var parentId = curiaElm.attr('data-curia-parentId');
		window.location.href = "/blog-details?topicId=" + elmId + "&categoryId=" + parentId; // n/studylane-blog-3
	});
	</script>
	<script type="text/javascript">var Blog = function() {
		//var categoryId = 0;
		//var user = {};
		//var _TENANT = Config.TENANT;
		//var _forumUrl = Config.API_SERVER;
		//var blogMasterPostId = 278060;
		//var ctr = 0;
		//var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

		var initialize = function() {
			BlogUtil.init(function(params, token) {

				Curia.init({
					serverUrl: Config.SERVER_URL,
					apiVersion: Config.API_VERSION,
					tenantId: Config.TENANT,
					development_userId: token.development_userId,
					authenticationToken: token.authenticationToken,
					debug: false,
					urlive: false,
					themes: Curia.themes,
					cookers: {
						cook_topicVariables: BlogUtil.cook_topicVariables,
						cook_topicImages: BlogUtil.cook_topicImages,
						cook_likes: BlogUtil.cook_likes
					}
				});

				jQuery.ajax({
					url :  Curia.addAuthenticationToken(Config.API_SERVER + "/currentUser"),
					success : function(data, textStatus, xhr) {
						if (xhr.status === 200) {
							if (data.userId != 0) {
								// Set profile avatar and name of current user
								var user = data;
								var userMenu = jQuery("#user-menu");
								jQuery(userMenu).find(".logged-user-name").text(user.firstName + " " + user.lastName);
								jQuery(userMenu).find(".logged-user-profile-image").css("background-image", "url("+ user.avatar +")");
								jQuery(userMenu).show();

								// Set current user roleId to config
								Config.CURRENT_ROLE_ID = data.roleId;
							} else {
								jQuery("#signup-login").show();
							}

							var before = Date.now();
							// Select the elements
							$.blockUI({ message: '<img src="https://studylane.com.au/studylane_t/images/icons/loading/loading-icon-studylane.gif" />' });
							CrowdHound.select({
								type: 'topic',
								withChildren: true
							}, function(err, selection) {
								if (err) {
									console.log('Error during select: ', err);
									return;
								}

								var selectTime = Date.now();
								var elapsed = selectTime - before;
								console.log('\n\nSELECT TOOK: ' + elapsed + 'ms\n\n');

								console.log('\nAfter select(): ', selection);
								// Now cook the data
								CrowdHound.cook({ }, selection, function(err, selection) {
									if (err) {
										console.log('Error during cooking: ', err);
										return;
									}
									console.log('\nAfter cook(): ', selection);

									var cookTime = Date.now();
									var elapsed = cookTime - selectTime;
									console.log('\n\nCOOK TOOK: ' + elapsed + 'ms\n\n');
									var elapsed = cookTime - before;
									console.log('\n\nSELECT AND COOK TOOK: ' + elapsed + 'ms\n\n');

									// Now display the data
									CrowdHound.render({
										target: '#blogMainDiv',
										theme: 'blog_topics'
									}, selection, function(err, selection) {
										if (err) {
											console.log('Error during display: ', err);
											return;
										}
										$.unblockUI();
										console.log('\nAfter display(): ', selection);
									});
								});
							});
							/*
							Curia.displayThread('#blogMainDiv', blogMasterPostId, 'blog_topics', function() {
							$(".blog-title").dotdotdot();
						});
						*/
					} else {
						BlogUtil.redirect(data.roleId);
					}
				}
			});
		});
	};

	/**
	*  This function is now replaced with a 'cooker'.
	*	See cookBlog in blog_util.js.
	*/
	/*
	var preProcess = function(element, selector, level, callback) {
	if (element != undefined) {
	Curia.getVoteTotals(element.id, 'like',  function(reply) {

	BlogUtil.getTopicImage(element.id, function(responseData) {
	var votes = reply[0];
	if (votes != undefined) {
	var likes = votes.likes == undefined ? 0 : votes.likes;
	element.likes = likes;
	if (likes > 1) {
	element.likePlural = true;
}
}

element.date_posted = (element.created==0) ? "(unknown creation time)" : BlogUtil.dateParser(element.created);

if (element.modified > element.created) {
element.date_modified = (element.modified==0) ? "(unknown modified time)" : BlogUtil.dateParser(element.modified);
}

if (element.type == "category") {
element.jsonValue = JSON.stringify({
summary : element.summary,
description : element.description,
id : element.id,
parentId : element.parentId,
rootId : element.rootId
}).replace(/\"/g, "\\\"");
}

if (element.type == "topic" && ctr <= 0) {
element.featuredTopic = true;
ctr++;
} else if (element.type == "topic" && ctr <= 4) {
element.latestTopic = true;
if (ctr == 1) {
element.firstRow = true;
}
if (ctr == 4) {
element.endRow = true;
}
ctr++;
} else if (element.type == "topic" && ctr > 4) {
element.nextRow = true;
if (ctr % 5 == 0) {
element.firstOffset = true;
} else {
element.firstOffset = false;
}
ctr++;
}

if (element.type == "topic") {
element.banner_image = responseData.bannerImage;
}

if(element && element.children && element.children.length) {
if( element.type == "category" ) {
var _children = [];
for( i = 0 ; i < element.children.length ; i++ ) {
if( !element.children[i].deleted ) {
_children.push(element.children[i]);
}
}
element.children = _children;
}
var childCount = element.children.length;
(function iterate(i){
if(i >= childCount){
callback(element);
}
var child = element.children[i];
if(i%100){
preProcess(child, selector, level+1, function(){
i++;
iterate(i);
});
} else {
setTimeout(function(){
preProcess(child, selector, level+1, function(){
i++;
iterate(i);
});
}, 0);
}
})(0); //start iteration

} else {
return callback(element);
}

});

});
}
};
*/

//Search --
var search = function(element, selector, level) {

	BlogUtil.getTopicImage(element.id, function(responseData) {
		if (element.type == "topic") {
			element.banner_image = responseData.bannerImage;
		}
		BlogUtil.getVoteTotals(element.id, 'like',  function(reply) {
			if (reply != undefined) {
				element.likes = reply[0].num;
				if (element.likes > 1) {
					element.likePlural = true;
				}
			}

			element.createdDateFromNow = (element.created==0) ? "(unknown creation time)" : BlogUtil.dateFromNow(element.created);
			if (element.modified > element.created) {
				element.modifiedDateFromNow = (element.modified==0) ? "(unknown modified time)" : BlogUtil.dateFromNow(element.modified);
			}

			if (element && element.children) {
				jQuery(element.children).each( function(index, child) {
					search(child);
				} );
			}
			return element;
		}, false);
	}, false);
};

var pagination = function( element, cnt ) {
	var _paginationTpl = jQuery('#blog-pagination-tpl').clone();
	var _content = jQuery(_paginationTpl.html());
	_content.addClass('pagination-links');
	var _cnt = cnt || getElementCount(element, "topic");
	var _count = parseInt(jQuery('.pageCount').val());
	if( _cnt > 0 && _count > 0 ) {
		var _pageCount = Math.ceil(_cnt/_count);

		var _pageTpl = _content.find('.number').clone();
		_content.find('.number').remove();
		for( i = 1 ; i <= _pageCount ; i++ ) {
			var _tmp = _pageTpl.clone();
			_tmp.find('a').html(i);
			_tmp.find('a').data('page', i);
			_tmp.find('a').click( function() {
				var _this = jQuery(this);
				_content.find('.number').removeClass('active');
				_this.closest('.number').addClass('active');
				var _pageNo = parseInt(_this.data('page'));

				_content.find('.first, .prev, .last, .next').removeClass('disabled');

				if( _pageNo == parseInt(_content.find('.number:last').find('a').data('page')) ) {
					_content.find('.last, .next').addClass('disabled');
				}
				if( _pageNo == parseInt(_content.find('.number:first').find('a').data('page')) ) {
					_content.find('.first, .prev').addClass('disabled');
				}

				var _pageMax = _pageNo * _count;
				var _pageMin = (_pageNo - 1) * _count;
				jQuery('#blogListMainDiv').find('.listTopic:not(.hidden)').addClass('hidden');
				var _elements = jQuery('#blogListMainDiv').find('.listTopic');
				for( i = _pageMin ; i < _pageMax ; i++ ) {
					jQuery(_elements[i]).removeClass('hidden');
				}
			} );
			_content.find('.next').before(_tmp);
		}
		_content.find('.number:first').find('a').click();
		_content.find('.first, .prev').addClass('disabled');
		_content.find('.number:first').addClass('active');
		_content.find('.first').click( function() {
			_content.find('.number:first').find('a').click();
		} );
		_content.find('.last').click( function() {
			_content.find('.number:last').find('a').click();
		} );
		_content.find('.next').click( function() {
			_content.find('.number.active').next('.number').find('a').click();
		} );
		_content.find('.prev').click( function() {
			_content.find('.number.active').prev('.number').find('a').click();
		} );
		jQuery('#blog-list-posts').find('.pagination-links').remove();
		jQuery('#blogListMainDiv').after(_content);
	}
};

var getElementCount = function(element, type) {
	var _cnt = 0;
	if( !(element instanceof Array) ) {
		element = [element];
	}
	for( i = 0, count = element.length ; i < count ; i++ ) {
		if( element[i].type == type ) {
			_cnt ++;
		}
		if( element[i].children ) {
			_cnt += getElementCount(element[i].children, type);
		}
	}
	return _cnt;
}

/*
var dateParser = function( timestamp ) {
var date = new Date(timestamp * 1000);
var cDate = new Date();
var fDate = "";
var eDate = {
hours : date.getHours(),
minutes : date.getMinutes(),
seconds : date.getSeconds(),
ampm : "AM",
month : date.getMonth(),
date : date.getDate(),
year : date.getFullYear()
};
if( date.getFullYear() == cDate.getFullYear() &&
date.getMonth() == cDate.getMonth() &&
date.getDate() == cDate.getDate() ) {
fDate = "Today,";
if( cDate.getHours() > date.getHours() ) {
fDate += " " + (cDate.getHours() - date.getHours()) + " hours";
}
if( cDate.getMinutes() > date.getMinutes() ) {
fDate += " " + (cDate.getMinutes() - date.getMinutes()) + " minutes";
}
if( cDate.getSeconds() > date.getSeconds() ) {
fDate += " " + (cDate.getSeconds() - date.getSeconds()) + " seconds";
}
fDate += " ago";
} else {
if( eDate.hours >= 12 ) {
eDate.hours = eDate.hours - 12;
eDate.hours = eDate.hours == 0 ? 12 : eDate.hours;
eDate.ampm = "PM";
}
eDate.hours = eDate.hours < 10 ? "0" + eDate.hours : eDate.hours;
eDate.minutes = eDate.minutes < 10 ? "0" + eDate.minutes : eDate.minutes;
eDate.seconds = eDate.seconds < 10 ? "0" + eDate.seconds : eDate.seconds;
eDate.month = monthNames[eDate.month];
eDate.date = eDate.date < 10 ? "0" + eDate.date : eDate.date;
fDate = eDate.month + " " + eDate.date + ", " + eDate.year + " " + eDate.hours + ":" + eDate.minutes + ":" + eDate.seconds + " " + eDate.ampm ;
}
return fDate;
};
*/

/*
var filterCategoryTopics = function(element, selector, level) {
element = preProcess(element);
element.children = getWithConditions(element, "id", categoryId, "category");
return element;
};
*/

return {
	init : initialize,
	//preProcess : preProcess,
	search : search,
	//displayTopic: displayTopic,
	//dateParser : dateParser,
	//pagination : pagination,
}
}();

jQuery(document).ready(function() {
	Curia.themes = jQuery.extend(Curia.themes, {
		"blog_topics" : {
			//"preprocessor" : Blog.preProcess,
			//"postprocessor" : function(element, selector) {
			//},
			"wrapper" : "#blog-template-category-list",
			//"category-list_0" : '#blog-template-category-list',
			//"category_0" : '#blog-template-category',
			"topic_0": '#blog-template-topic',
			"message_0": ' ',
			"attachment_0": ' '
		}
	});
	Blog.init();
});

/*
jQuery('.pageCount').change(function(e){
pagination(null, jQuery('#blogListMainDiv').find('.listTopic').length);
});
*/

jQuery(document).on('click', '.search_button', function(e) {
	var _this = jQuery(this);
	var _target = jQuery(_this.attr('data-target'));
	var _tpl = jQuery(_this.attr('data-template'));
	var _targetTypes = _this.attr('data-target-types').split(",");
	var _callback = _this.attr('data-callback');
	var _preprocess = _this.attr('data-preprocess');
	var _txtField = jQuery(_this.attr('data-textfield'));
	_preprocess = _preprocess && _preprocess != '' ? _preprocess.split(".") : [];
	var _val = _txtField.val();
	if( _val.trim() != '' ) {
		jQuery.ajax({
			url : Config.API_SERVER +  "/search/" + _val + '?type=topic',
			type : "GET",
			success : function(data) {
				data = typeof data == "string" ? JSON.parse(data) : data;
				var filtered = {};
				for( i = 0 ; i < data.length ; i++ ) {
					var _data = data[i];
					if( !data[i].deleted ) {
						for( j = 0 ; j < _targetTypes.length ; j++ ) {
							if( _targetTypes[j] == data[i].type ) {
								filtered[data[i].id] = data[i];
							}
						}
					}
				}
				var hasResults = false;
				_tpl = _tpl.html();
				var _mustache = _tpl;
				var _mustache = "{{=<< >>=}}" + _mustache + "<<={{ }}=>>";
				var elements = [];
				for( var key in filtered ) {
					hasResults = true;
					filtered[key]["is_" + filtered[key].type] = true;
					elements.push(filtered[key]);
				}
				var ppfnc = window;
				for( i = 0 ; i < _preprocess.length ; i++ ) {
					ppfnc = ppfnc[_preprocess[i]];
				}
				if( typeof ppfnc == "function" ) {
					try {
						elements = ppfnc({children : elements, type : "category"}).children;
					} catch(e) {
						//console.log(e)
					}
				}
				var _element = {elements : elements, query : _val};
				var _html = Mustache.render(_mustache, _element);
				if( !hasResults ) {
					_target.html('<div class="error">There are no articles available for "'+_val+'."</div>');
				} else {
					_target.html(_html);
				}

				if( _callback && _callback != '' ) {
					var _cb = _callback.match('function\\(.*?\\){(.*?)};{0,1}');
					if( _cb && _cb.length > 1 ) {
						_cb = new Function('element', _cb[1]);
						_cb(elements);
					} else {
						var fnc = window;
						_callback = _callback.split('.');
						for( i = 0 ; i < _callback.length ; i++ ) {
							fnc = fnc[_callback[i]];
						}
						if( typeof fnc == "function" ) {
							elements = fnc(elements);
						}
					}
				}
			}
		});
	}
});
</script>
<script type="text/javascript">var BlogSearch = function(){
    var initialize = function() {
        events();
        setOptions();
    }

    var showModal = function(btnElem) {
        btnElem.addClass('active');
        btnElem.find('.icon').hide();
        $('.search-box').show();
        $('#search_blog').val('');
        $('.modal-backdrop').remove()
        $('body').append('<div class="modal-backdrop fade in"></div>');
    }

    var hideModal = function() {
        $('.modal-backdrop').remove()
        $('.button-search .icon').show()
        $('.button-search').removeClass('active')
        $('.button-search').show()
        $('.search-box').hide();
    }

    var events = function() {
        $(document).on('click', '.button-search',function(){
            var me = $(this);
            if(!me.hasClass('active'))
				showModal(me);
        })

        $(document).on('click', '.modal-backdrop', function(){
			hideModal();
        })

        $(document).on('keydown', '#search_blog', function(e){
			var code = e.keyCode;
            if(code === 13)
                $('.search_button').click();
        })
    }

    var setOptions = function() {
		var btnSearch = $('.search_button');
        if (location.href.indexOf("studylane-blog-1") > -1 || location.href.indexOf("blog-home") > -1) { //Blog Home
            btnSearch.attr('data-target-types', 'topic');
            btnSearch.attr('data-preprocess', 'Blog.search');
            btnSearch.attr('data-callback', 'function(element){BlogSearch.hideModal();}');
            btnSearch.attr('data-target', '#blogMainDiv')
        } else if(location.href.indexOf("studylane-blog-4") > -1 || location.href.indexOf("blog-admin-category") > -1) { //Admin Category Maintenance
			btnSearch.attr('data-target-types', 'category');
            btnSearch.attr('data-preprocess', 'AdminBlogCategory.search');
            btnSearch.attr('data-callback', 'function(element){BlogSearch.hideModal();}');
            btnSearch.attr('data-target', '.search-container')
        } else if(location.href.indexOf("studylane-blog-2") > -1 || location.href.indexOf("blog-admin") > -1) { //Admin Blog Maintenance
			btnSearch.attr('data-target-types', 'topic');
            btnSearch.attr('data-preprocess', 'AdminBlog.search');
            btnSearch.attr('data-callback', 'function(element){BlogSearch.hideModal();}');
            btnSearch.attr('data-target', '.search-container')
        }
    }

    return {
        init : initialize,
        showModal : showModal,
        hideModal : hideModal
    }
}();

$(document).ready(function(){
	BlogSearch.init();
})</script>




















</html>
